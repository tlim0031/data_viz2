{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": { "url": "https://raw.githubusercontent.com/tlim0031/data_viz2/refs/heads/main/data/monthly_arrivals_by_state_nationality_and_gender.csv" },
    "width": "container", 
    "height": 280,
    "params": [
        {
            "name": "Year_selected",
            "value": 2022,
            "bind": {
                "input": "range",
                "min": 2020, 
                "max": 2024,
                "step": 1,
                "name": "Select Year: "
            }
        }
    ],
    "transform": [
        {
            "fold": ["arrivals_male", "arrivals_female"], "as": ["gender", "total_arrivals"]
        },
        {
            "filter": "year(datum.date) == Year_selected"
        },
        {
            "calculate": "datum.gender === 'arrivals_male' ? 'Male' : 'Female'",
            "as": "gender_label"
        }
    ],
    "layer": [
        {
            "mark": "bar",
            "encoding": {
                "x": {"timeUnit": "month", "field": "date", "type": "ordinal", "title": "Month"},
                "y": {"field": "total_arrivals", "aggregate": "sum", "type": "quantitative",
                "axis": {
                  "title": "Total Arrivals", "format": ",.0f"
                }
              },
                "color": {"field": "gender_label", "type": "nominal",
                    "scale": {
                        "domain": ["Male", "Female"], "range": ["#a2d2ff", "#ffafcc"]
                    },
                    "title": "Gender"
                },
                "tooltip": [
                    {"field": "date", "timeUnit": "year", "type": "nominal", "title": "Year"},
                    {"field": "date", "timeUnit": "month", "type": "ordinal", "title": "Month"},
                    {"field": "arrivals_male", "aggregate": "sum","type": "quantitative",
                      "title": "Total Arrivals (Male)", "format": ",.0f"},
                    {"field": "arrivals_female", "aggregate": "sum","type": "quantitative",
                      "title": "Total Arrivals (Female)", "format": ",.0f"}]
            }
        },
        {
            "mark": {"type": "line", "interpolate": "monotone","point": true, "tooltip": true
            },
            "encoding": {
                "x": {"field": "date", "timeUnit": "month","title": "Month"},
                "y": {"field": "total_arrivals", "aggregate": "sum", "title": "Total Arrivals"},
                "tooltip": [
                    {"field": "date", "timeUnit": "year", "type": "nominal", "title": "Year"},
                    {"field": "date", "timeUnit": "month", "type": "ordinal", "title": "Month"},
                    {"field": "total_arrivals", "aggregate": "sum","type": "quantitative",
                      "title": "Total Arrivals", "format": ",.0f"}]
            }
        },
        {
          "mark": {
            "type": "text", 
            "align": "right", 
            "baseline": "middle", 
            "dx": 150,
            "dy": -50, 
            "fontSize": 11.5, 
            "fontStyle": "italic",
            "color": "red"
          },
          "encoding": {
            "x": {
              "timeUnit": "month",
              "field": "date",
              "type": "ordinal"
            },
            "y": {
              "aggregate": "sum",
              "field": "total_arrivals",
              "type": "quantitative"
            },
            "text": {
              "value": ["Significant drop in tourist arrivals", "due to COVID-19 pandemic."] 
            }
          },
          "transform": [
            {
              "filter": "year(datum.date) == 2020 && month(datum.date) == 3" 
            }
          ]
        },
        {
          "mark": {
            "type": "text", 
            "align": "right", 
            "baseline": "middle", 
            "dx": -20,
            "fontSize": 11.5, 
            "fontStyle": "italic",
            "color": "red"
          },
          "encoding": {
            "x": {
              "timeUnit": "month",
              "field": "date",
              "type": "ordinal"
            },
            "y": {
              "aggregate": "sum",
              "field": "total_arrivals",
              "type": "quantitative"
            },
            "text": {
              "value": ["Spike in tourist arrivals", "showing post COVID-19 recovery."] 
            }
          },
          "transform": [
            {
              "filter": "year(datum.date) == 2021 && month(datum.date) == 11" 
            }
          ]
        },
        {
          "mark": {
            "type": "text", 
            "align": "right", 
            "baseline": "middle", 
            "dx": -20,
            "fontSize": 11.5, 
            "fontStyle": "italic",
            "color": "red"
          },
          "encoding": {
            "x": {
              "timeUnit": "month",
              "field": "date",
              "type": "ordinal"
            },
            "y": {
              "aggregate": "sum",
              "field": "total_arrivals",
              "type": "quantitative"
            },
            "text": {
              "value": ["Steady increase in", "tourist arrivals"] 
            }
          },
          "transform": [
            {
              "filter": "year(datum.date) == 2022 && month(datum.date) == 3" 
            }
          ]
        },
        {
          "mark": {
            "type": "text", 
            "align": "right", 
            "baseline": "middle", 
            "dx": -10,
            "dy": -35,
            "fontSize": 11.5, 
            "fontStyle": "italic",
            "color": "red"
          },
          "encoding": {
            "x": {
              "timeUnit": "month",
              "field": "date",
              "type": "ordinal"
            },
            "y": {
              "aggregate": "sum",
              "field": "total_arrivals",
              "type": "quantitative"
            },
            "text": {
              "value": ["Gradual increment in", "tourist arrivals"] 
            }
          },
          "transform": [
            {
              "filter": "year(datum.date) == 2023 && month(datum.date) == 3" 
            }
          ]
        }
    ]
}
